<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Casa Capricornio | Pedido de Agua</title>
  <style>
    body{background:#0b1220;color:#fff;font-family:Arial,Helvetica,sans-serif;padding:18px}
    input,select,button{padding:10px;margin:6px 0;width:280px;max-width:100%}
    button{cursor:pointer}
    hr{margin:18px 0;border:0;border-top:1px solid #445}
    h2,h3{margin:10px 0}
    .box{max-width:520px}
  </style>
</head>
<body>
  <div class="box">
    <h2>Pedido simple por WhatsApp â€” Entrega por ruta</h2>

    <label>Nombre</label><br>
    <input id="name" placeholder="Tu nombre"><br>

    <label>Zona</label><br>
    <select id="zone">
      <option>El Chorro</option>
      <option>Lote 8</option>
      <option>MarÃ­a Cristina</option>
      <option>El Palmar</option>
      <option>El Favorito</option>
      <option>El Potrillo</option>
      <option>Quebracho</option>
    </select><br>

    <label>Cantidad de bidones (20 L)</label><br>
    <input id="qty" type="number" min="1" value="1"><br>

    <label>WhatsApp cliente (opcional)</label><br>
    <input id="clientKey" placeholder="3704... (opcional)"><br>

    <button id="orderBtn">PEDIR POR WHATSAPP</button>

    <hr>

    <h3>ðŸšš Control de entrega</h3>

    <label>ID del pedido</label><br>
    <input id="pedidoId" placeholder="CC-..."><br>

    <label>Repartidor</label><br>
    <select id="repartidor">
      <option>Carlitos</option>
      <option>Barto</option>
    </select><br>

    <label>PIN</label><br>
    <input id="pin" type="password" placeholder="3232"><br>

    <button id="entregadoBtn">MARCAR ENTREGADO</button>
  </div>

  <script>
    // ======= CONFIGURACIÃ“N =======
    const WHATSAPP_NUMBER = "543704418194";
    const API_URL = "https://script.google.com/macros/s/AKfycby90m4hZisAzjG2B9jjRSFBDmj9WD6f6eYBiyIcsAGoFVBf6r0lagv-ebjVkAzEBtQN/exec";
    const TOKEN = "CAPRICORNIO_2025";

    async function apiCall(payload){
      // IMPORTANTE: con Apps Script normalmente se usa no-cors (no se puede leer JSON desde el navegador).
      await fetch(API_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
    }

    document.getElementById("orderBtn").addEventListener("click", async () => {
      const nombre = document.getElementById("name").value.trim();
      const zona = document.getElementById("zone").value.trim();
      const cantidad = document.getElementById("qty").value.trim();
      const whatsapp_cliente = document.getElementById("clientKey").value.trim();

      if(!nombre || !zona || !cantidad){
        alert("CompletÃ¡ nombre, zona y cantidad");
        return;
      }

      // Genero ID en la web (asÃ­ lo ves al toque y lo copiÃ¡s)
      const pedido_id = "CC-" + Date.now();
      document.getElementById("pedidoId").value = pedido_id;

      // 1) Guardar en Sheets
      await apiCall({
        action: "create_order",
        pedido_id,
        nombre,
        zona,
        cantidad,
        whatsapp_cliente
      });

      // 2) Abrir WhatsApp
      const msg = `Hola, buen dÃ­a. Quiero pedir agua purificada Casa Capricornio.
Estoy en ${zona} y necesito ${cantidad} bidÃ³n(es) de 20 L.
Mi nombre: ${nombre}
ID Pedido: ${pedido_id}
Gracias.`;

      window.open("https://wa.me/" + WHATSAPP_NUMBER + "?text=" + encodeURIComponent(msg), "_blank");
      alert("Pedido enviado (se guardÃ³ en la planilla).");
    });

    document.getElementById("entregadoBtn").addEventListener("click", async () => {
      const pedido_id = document.getElementById("pedidoId").value.trim();
      const repartidor = document.getElementById("repartidor").value.trim();
      const pin = document.getElementById("pin").value.trim();

      if(!pedido_id || !pin){
        alert("Falta ID del pedido o PIN");
        return;
      }

      await apiCall({
        action: "mark_delivered",
        pedido_id,
        repartidor,
        pin,
        token: TOKEN
      });

      alert("Pedido marcado como ENTREGADO (revisÃ¡ la planilla).");
    });
  </script>
</body>
</html>





